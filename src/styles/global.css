/* Import theme CSS variables */
@import "./theme.css";
@import "./shiki-theme.css";

/* Import Tailwind CSS directives */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Font Face Declarations */
@font-face {
  font-family: "AdwaitaMono";
  src: url("/fonts/AdwaitaMono/AdwaitaMonoNerdFontMono-Regular.ttf") format("truetype");
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "AdwaitaMono";
  src: url("/fonts/AdwaitaMono/AdwaitaMonoNerdFontMono-Bold.ttf") format("truetype");
  font-weight: bold;
  font-style: normal;
  font-display: swap;
}

@font-face {
  font-family: "AdwaitaMono";
  src: url("/fonts/AdwaitaMono/AdwaitaMonoNerdFontMono-Italic.ttf") format("truetype");
  font-weight: normal;
  font-style: italic;
  font-display: swap;
}

@font-face {
  font-family: "AdwaitaMono";
  src: url("/fonts/AdwaitaMono/AdwaitaMonoNerdFontMono-BoldItalic.ttf") format("truetype");
  font-weight: bold;
  font-style: italic;
  font-display: swap;
}

/* Scrolling Variables */
:root {
  --scroll-timing-function: cubic-bezier(0.25, 0.1, 0.25, 1);
  --scroll-transition-duration: 400ms;
}

@layer base {
  * {
    @apply m-0 box-border p-0;
  }

  /* Base body and html styles */
  html {
    @apply scroll-smooth font-mono transition-all duration-300 ease-in-out;
    overscroll-behavior: contain;
    scrollbar-gutter: stable;
    /* Prevent dynamic height changes */
    position: relative;
    isolation: isolate;
  }

  body {
    @apply bg-black font-mono text-sm text-text-primary sm:text-base;
    overscroll-behavior: contain;
    -webkit-overflow-scrolling: touch;
    /* Improve touch handling */
    touch-action: manipulation;
    /* GPU acceleration for smoother scrolling */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    /* Create stacking context */
    position: relative;
    isolation: isolate;
  }

  /* Terminal glow for headers with phosphor persistence */
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    animation: phosphor-glow 2s ease-in-out infinite alternate;
  }

  @keyframes phosphor-glow {
    0% {
      text-shadow:
        0 0 5px var(--terminal-glow),
        0 0 10px var(--terminal-glow),
        0 0 15px var(--terminal-glow);
    }
    100% {
      text-shadow:
        0 0 10px var(--terminal-glow-intense),
        0 0 20px var(--terminal-glow-intense),
        0 0 30px var(--terminal-glow-intense),
        0 0 40px var(--terminal-glow);
    }
  }

  /* Responsive breakpoint optimizations */
  @media (max-width: 640px) {
    :root {
      --scroll-transition-duration: 300ms;
    }

    html,
    body {
      @apply w-full;
    }
  }

  @media (min-width: 640px) and (max-width: 1023px) {
    :root {
      --scroll-transition-duration: 350ms;
    }
  }

  /* Smooth transitions between breakpoints */
  @media (prefers-reduced-motion: no-preference) {
    * {
      @apply transition-[padding,margin] duration-300 ease-in-out;
    }
  }

  /* Mobile touch target sizes */
  @media (max-width: 767px) {
    button,
    a {
      @apply min-h-[44px] min-w-[44px];
    }
  }

  /* Global overflow controls */
  * {
    @apply box-border max-w-full;
  }

  img,
  video,
  iframe,
  embed,
  object {
    @apply h-auto max-w-full;
  }

  pre,
  code {
    @apply max-w-full overflow-x-auto break-words;
  }

  main {
    @apply relative;
  }
}

/* Global Focus Styles for Accessibility */
*:focus-visible {
  @apply rounded-sm outline-2 outline-offset-2 outline-primary;
}

button:focus-visible,
a:focus-visible {
  @apply outline-2 outline-offset-2 outline-primary;
}

/* Skip to main content link for screen readers */
.skip-to-main {
  @apply absolute left-[-9999px] z-[999] bg-black p-4 text-text-primary no-underline;
}

.skip-to-main:focus {
  @apply left-1/2 top-0 -translate-x-1/2;
}

/* Inline code styling (not part of Shiki) */
code:not(pre code) {
  @apply rounded bg-gray-800 px-[0.4rem] py-[0.2rem] font-mono;
}

/* Material Symbols Configuration */
.material-symbols-rounded,
.material-symbols-outlined {
  font-variation-settings:
    "FILL" 0,
    "wght" 400,
    "GRAD" 0,
    "opsz" 24;
}

.material-symbols-rounded.filled,
.material-symbols-outlined.filled {
  font-variation-settings:
    "FILL" 1,
    "wght" 400,
    "GRAD" 0,
    "opsz" 24;
}

/* Icon size variations */
.icon-sm {
  @apply text-[18px];
}

.icon-md {
  @apply text-2xl;
}

.icon-lg {
  @apply text-4xl;
}

/* Scrolling utilities */
.scroll-margin-top {
  scroll-margin-top: 2rem;
}

.scroll-padding {
  scroll-padding-top: 2rem;
}

/* CRT Effects - Minimal scanline overlay */
body::before {
  content: "";
  @apply pointer-events-none fixed left-0 top-0 z-[3] h-full w-full opacity-30;
  background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.05) 50%);
  background-size: 100% 4px;
  /* Viewport containment */
  max-width: 100%;
  max-height: 100%;
  overflow: hidden;
  contain: strict;
  clip-path: inset(0);
}

/* Theme dot styles */
.theme-dot {
  @apply mr-2 inline-block h-3 w-3 rounded-full;
}

.theme-dot-green {
  background-color: #00ff00;
}

.theme-dot-amber {
  background-color: #ffb000;
}

.theme-dot-monochrome {
  background-color: #ffffff;
}

.theme-dot-doom {
  background-color: #ff4100;
}

/* Legacy class mappings for compatibility */
.fade-in {
  @apply animate-fade-in;
}

.glitch-text {
  @apply hover:animate-glitch;
}

.typing-text {
  @apply animate-typing overflow-hidden whitespace-nowrap border-r-[3px] border-primary;
}

.loading {
  @apply after:animate-loading-dots after:text-primary after:content-['.'];
}

.glow {
  @apply animate-glow;
}

.slide-in {
  @apply animate-slide-in;
}

/* CRT overlay styling - removed duplicate (defined later in file) */

/* Matrix background */
.matrix-bg {
  @apply pointer-events-none fixed left-0 top-0 -z-10 h-full w-full bg-matrix-rain opacity-5;
}

/* Enhanced CRT screen effects - ULTRA MODE */
@layer utilities {
  /* Master CRT container with all effects */
  .crt-screen {
    position: relative;
    transform-style: preserve-3d;
    perspective: 1000px;
  }

  /* RGB Chromatic Aberration Effect */
  .crt-screen::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background:
      radial-gradient(ellipse at center, transparent 0%, transparent 65%, rgba(0, 0, 0, 0.4) 100%),
      repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(255, 0, 0, 0.03) 2px,
        rgba(255, 0, 0, 0.03) 4px
      ),
      repeating-linear-gradient(
        90deg,
        transparent,
        transparent 2px,
        rgba(0, 255, 0, 0.03) 2px,
        rgba(0, 255, 0, 0.03) 4px
      );
    pointer-events: none;
    z-index: 2;
    mix-blend-mode: multiply;
    animation: rgb-shift 8s ease-in-out infinite;
    /* Viewport containment */
    overflow: hidden;
    contain: strict;
    clip-path: inset(0);
    isolation: isolate;
  }

  @keyframes rgb-shift {
    0%,
    100% {
      transform: translate(0, 0);
    }
    33% {
      transform: translate(0.5px, -0.5px);
    }
    66% {
      transform: translate(-0.5px, 0.5px);
    }
  }

  /* Barrel Distortion & Screen Curvature */
  .crt-screen::after {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    border-radius: 10% / 50%;
    pointer-events: none;
    z-index: 3;
    animation: barrel-pulse 15s ease-in-out infinite;
    /* Enhanced viewport containment */
    overflow: hidden;
    contain: strict;
    clip-path: inset(0);
    isolation: isolate;
  }

  @keyframes barrel-pulse {
    0%,
    100% {
      opacity: 0.8;
    }
    50% {
      opacity: 0.6;
    }
  }

  /* Advanced Scanlines with Multiple Patterns */
  .crt-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    pointer-events: none;
    z-index: 4;
    /* Enhanced viewport containment */
    overflow: hidden;
    contain: strict;
    clip-path: inset(0);
    isolation: isolate;
    /* GPU acceleration */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0, 0, 0, 0.1) 2px,
      rgba(0, 0, 0, 0.1) 4px
    );
    animation: scanlines 8s linear infinite;
  }

  .crt-overlay::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      180deg,
      transparent 0%,
      rgba(255, 255, 255, 0.02) 50%,
      transparent 100%
    );
    background-size: 100% 10px;
    animation: scan-moving 3s linear infinite;
    /* Viewport containment */
    overflow: hidden;
    contain: strict;
    clip-path: inset(0);
  }

  .crt-overlay::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 15%;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.05), transparent);
    animation: scan-bar 6s linear infinite;
    opacity: 0.7;
    will-change: transform;
    /* Use transform for better performance */
    transform: translateY(-100%);
    /* Viewport containment */
    overflow: hidden;
    contain: strict;
  }

  @keyframes scanlines {
    0% {
      background-position: 0 0;
    }
    100% {
      background-position: 0 10px;
    }
  }

  @keyframes scan-moving {
    0% {
      transform: translateY(-10px);
    }
    100% {
      transform: translateY(0);
    }
  }

  @keyframes scan-bar {
    0% {
      transform: translateY(-100%);
    }
    100% {
      transform: translateY(calc(100% + 100%));
    }
  }

  /* Phosphor Glow & Persistence */
  .terminal-text-glow {
    text-shadow:
      0 0 2px var(--terminal-glow),
      0 0 5px var(--terminal-glow),
      0 0 10px var(--terminal-glow-intense);
    animation: phosphor-flicker 0.1s infinite;
  }

  .terminal-text-glow-intense {
    text-shadow:
      0 0 5px var(--terminal-glow),
      0 0 10px var(--terminal-glow),
      0 0 20px var(--terminal-glow-intense),
      0 0 30px var(--terminal-glow-intense);
    animation: phosphor-pulse 2s ease-in-out infinite;
  }

  @keyframes phosphor-flicker {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.98;
    }
  }

  @keyframes phosphor-pulse {
    0%,
    100% {
      filter: brightness(1);
    }
    50% {
      filter: brightness(1.1);
    }
  }

  /* Interference Patterns & Glitches */
  .crt-static {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    opacity: 0.03;
    z-index: 1;
    /* Enhanced viewport containment */
    overflow: hidden;
    contain: strict;
    clip-path: inset(0);
    isolation: isolate;
    /* GPU acceleration */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    background:
      repeating-radial-gradient(
        circle at 50% 50%,
        transparent 0,
        rgba(255, 255, 255, 0.01) 1px,
        transparent 2px,
        transparent 3px
      ),
      url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence baseFrequency='0.9' numOctaves='4' seed='5'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.4'/%3E%3C/svg%3E");
    background-size:
      3px 3px,
      100px 100px;
    animation:
      interference 5s linear infinite,
      static-shift 0.5s steps(10) infinite;
  }

  @keyframes interference {
    0%,
    40%,
    100% {
      opacity: 0.03;
    }
    10% {
      opacity: 0.06;
    }
    30% {
      opacity: 0.01;
    }
    50% {
      opacity: 0.05;
    }
    60% {
      opacity: 0.02;
    }
    90% {
      opacity: 0.04;
    }
  }

  @keyframes static-shift {
    0% {
      background-position:
        0 0,
        0 0;
    }
    20% {
      background-position:
        -3px 0,
        -5px -5px;
    }
    40% {
      background-position:
        3px 0,
        5px 5px;
    }
    60% {
      background-position:
        0 -3px,
        0 -5px;
    }
    80% {
      background-position:
        0 3px,
        0 5px;
    }
    100% {
      background-position:
        0 0,
        0 0;
    }
  }

  /* Voltage Fluctuation Effect */
  body {
    animation: voltage-flicker 20s ease-in-out infinite;
  }

  @keyframes voltage-flicker {
    0%,
    100% {
      filter: brightness(1) contrast(1);
    }
    92% {
      filter: brightness(1) contrast(1);
    }
    93% {
      filter: brightness(0.9) contrast(0.9);
    }
    94% {
      filter: brightness(1.1) contrast(1.1);
    }
    95% {
      filter: brightness(0.95) contrast(0.95);
    }
    96% {
      filter: brightness(1) contrast(1);
    }
  }

  /* Pixel Grid Overlay */
  .matrix-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    pointer-events: none;
    opacity: 0.03;
    z-index: 0;
    /* Viewport containment */
    overflow: hidden;
    contain: strict;
    clip-path: inset(0);
    isolation: isolate;
    /* GPU acceleration */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    background-image:
      repeating-linear-gradient(
        0deg,
        transparent,
        transparent 1px,
        rgba(0, 255, 0, 0.05) 1px,
        rgba(0, 255, 0, 0.05) 2px
      ),
      repeating-linear-gradient(
        90deg,
        transparent,
        transparent 1px,
        rgba(0, 255, 0, 0.05) 1px,
        rgba(0, 255, 0, 0.05) 2px
      );
    background-size: 2px 2px;
    animation: pixel-drift 60s linear infinite;
  }

  @keyframes pixel-drift {
    0% {
      transform: translate(0, 0);
    }
    100% {
      transform: translate(2px, 2px);
    }
  }

  /* Boot Animation */
  @keyframes crt-boot {
    0% {
      transform: scaleY(0.01) scaleX(0.8);
      filter: brightness(0);
    }
    10% {
      transform: scaleY(0.02) scaleX(0.9);
      filter: brightness(0.1);
    }
    20% {
      transform: scaleY(0.1) scaleX(0.95);
      filter: brightness(0.2);
    }
    40% {
      transform: scaleY(0.5) scaleX(0.98);
      filter: brightness(0.5);
    }
    60% {
      transform: scaleY(0.8) scaleX(0.99);
      filter: brightness(0.8);
    }
    80% {
      transform: scaleY(0.95) scaleX(1);
      filter: brightness(0.9);
    }
    100% {
      transform: scaleY(1) scaleX(1);
      filter: brightness(1);
    }
  }

  /* Apply boot animation on page load */
  .terminal-wrapper {
    animation: crt-boot 0.5s ease-out;
  }

  /* Power Off Effect (can be triggered via JS) */
  @keyframes crt-power-off {
    0% {
      transform: scaleY(1) scaleX(1);
      filter: brightness(1);
    }
    50% {
      transform: scaleY(0.01) scaleX(1);
      filter: brightness(2);
    }
    100% {
      transform: scaleY(0.01) scaleX(0);
      filter: brightness(0);
    }
  }

  /* Chromatic Text Effect */
  .chromatic-text {
    position: relative;
    animation: chromatic-shift 0.5s ease-in-out infinite alternate;
  }

  .chromatic-text::before,
  .chromatic-text::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .chromatic-text::before {
    color: rgba(255, 0, 0, 0.5);
    animation: chromatic-r 0.5s ease-in-out infinite alternate;
    z-index: -1;
  }

  .chromatic-text::after {
    color: rgba(0, 255, 255, 0.5);
    animation: chromatic-b 0.5s ease-in-out infinite alternate;
    z-index: -1;
  }

  @keyframes chromatic-r {
    0%,
    100% {
      transform: translateX(-0.5px);
    }
    50% {
      transform: translateX(0.5px);
    }
  }

  @keyframes chromatic-b {
    0%,
    100% {
      transform: translateX(0.5px);
    }
    50% {
      transform: translateX(-0.5px);
    }
  }

  @keyframes chromatic-shift {
    0%,
    100% {
      filter: hue-rotate(0deg);
    }
    50% {
      filter: hue-rotate(2deg);
    }
  }

  /* Phosphor Burn-in Effect */
  .phosphor-burn {
    position: relative;
  }

  .phosphor-burn::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    color: var(--terminal-glow);
    opacity: 0.1;
    filter: blur(3px);
    z-index: -1;
    animation: burn-in 15s ease-in-out infinite;
    transform: translate(0, 0);
  }

  @keyframes burn-in {
    0%,
    100% {
      transform: translate(0, 0) scale(1);
      opacity: 0.05;
    }
    25% {
      transform: translate(0.5px, 0) scale(1.002);
      opacity: 0.08;
    }
    50% {
      transform: translate(-0.5px, 0.5px) scale(1.001);
      opacity: 0.06;
    }
    75% {
      transform: translate(0, -0.5px) scale(1.002);
      opacity: 0.08;
    }
  }

  /* Random Glitch Effect */
  @keyframes glitch {
    0%,
    100% {
      transform: translate(0);
      filter: hue-rotate(0deg);
    }
    2% {
      transform: translate(2px, 2px);
      filter: hue-rotate(90deg) saturate(2);
    }
    4% {
      transform: translate(-2px, -2px);
      filter: hue-rotate(-90deg) saturate(2);
    }
    6% {
      transform: translate(0);
      filter: hue-rotate(0deg);
    }
  }

  /* Apply random glitch to elements */
  .terminal-wrapper > * {
    animation: glitch 30s infinite;
    animation-delay: calc(var(--animation-order, 0) * 0.1s);
  }
}
