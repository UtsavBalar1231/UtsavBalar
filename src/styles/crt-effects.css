/* CRT Effects - Complex terminal visual effects */

/* Mobile-first approach - Disable all heavy effects on mobile for performance */
@media (max-width: 767px) {
  /* Kill all CRT effects on mobile */
  .crt-screen::before,
  .crt-screen::after,
  .crt-overlay,
  .crt-overlay::before,
  .crt-overlay::after,
  .crt-static,
  body::before {
    display: none !important;
  }

  /* Disable matrix background animation */
  .matrix-bg {
    animation: none !important;
    opacity: 0 !important;
  }

  /* Set performance mode to maximum */
  :root {
    --crt-intensity: 0 !important;
  }
}

/* Prefers Reduced Motion Support */
@media (prefers-reduced-motion: reduce) {
  /* Disable all animations for users who prefer reduced motion */
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  /* Hide complex CRT effects */
  .crt-screen::before,
  .crt-screen::after,
  .crt-overlay,
  .crt-overlay::before,
  .crt-overlay::after,
  .crt-static,
  body::before {
    display: none !important;
  }

  /* Keep simple matrix background but static */
  .matrix-bg {
    animation: none !important;
  }
}

/* Performance Mode - Use CSS custom property to control intensity */
:root {
  --crt-intensity: 1; /* 0 = off, 0.5 = reduced, 1 = full */
}

/* CRT Effects - Minimal scanline overlay */
body::before {
  content: "";
  @apply pointer-events-none fixed left-0 top-0 z-[3] h-full w-full;
  opacity: calc(0.3 * var(--crt-intensity, 1));
  background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.05) 50%);
  background-size: 100% 4px;
  will-change: opacity;
  /* Viewport containment */
  max-width: 100%;
  max-height: 100%;
  overflow: hidden;
  contain: strict;
  clip-path: inset(0);
}

/* Matrix background */
.matrix-bg {
  @apply pointer-events-none fixed left-0 top-0 -z-10 h-full w-full bg-matrix-rain opacity-5;
}

/* Enhanced CRT screen effects - ULTRA MODE */
@layer utilities {
  /* Master CRT container with all effects */
  .crt-screen {
    position: relative;
    transform-style: preserve-3d;
    perspective: 1000px;
  }

  /* RGB Chromatic Aberration Effect */
  .crt-screen::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background:
      radial-gradient(ellipse at center, transparent 0%, transparent 65%, rgba(0, 0, 0, 0.4) 100%),
      repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(255, 0, 0, 0.03) 2px,
        rgba(255, 0, 0, 0.03) 4px
      ),
      repeating-linear-gradient(
        90deg,
        transparent,
        transparent 2px,
        rgba(0, 255, 0, 0.03) 2px,
        rgba(0, 255, 0, 0.03) 4px
      );
    pointer-events: none;
    z-index: 2;
    mix-blend-mode: multiply;
    animation: rgb-shift 8s ease-in-out infinite;
    animation-play-state: running;
    opacity: var(--crt-intensity, 1);
    /* Viewport containment */
    overflow: hidden;
    contain: strict;
    clip-path: inset(0);
    isolation: isolate;
  }

  /* Barrel Distortion & Screen Curvature */
  .crt-screen::after {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    border-radius: 10% / 50%;
    pointer-events: none;
    z-index: 3;
    animation: barrel-pulse 15s ease-in-out infinite;
    animation-play-state: running;
    opacity: calc(0.8 * var(--crt-intensity, 1));
    /* Enhanced viewport containment */
    overflow: hidden;
    contain: strict;
    clip-path: inset(0);
    isolation: isolate;
  }

  /* Advanced Scanlines with Multiple Patterns */
  .crt-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    pointer-events: none;
    z-index: 4;
    /* Enhanced viewport containment */
    overflow: hidden;
    contain: strict;
    clip-path: inset(0);
    isolation: isolate;
    /* GPU acceleration */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0, 0, 0, 0.1) 2px,
      rgba(0, 0, 0, 0.1) 4px
    );
    animation: scanlines 8s linear infinite;
    animation-play-state: running;
    opacity: calc(0.5 * var(--crt-intensity, 1));
  }

  .crt-overlay::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      180deg,
      transparent 0%,
      rgba(255, 255, 255, 0.02) 50%,
      transparent 100%
    );
    background-size: 100% 10px;
    animation: scan-moving 3s linear infinite;
    /* Viewport containment */
    overflow: hidden;
    contain: strict;
    clip-path: inset(0);
  }

  .crt-overlay::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 15%;
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.05), transparent);
    animation: scan-bar 6s linear infinite;
    opacity: 0.7;
    will-change: transform;
    /* Use transform for better performance */
    transform: translateY(-100%);
    /* Viewport containment */
    overflow: hidden;
    contain: strict;
  }

  /* Interference Patterns & Glitches */
  .crt-static {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    opacity: 0.03;
    z-index: 1;
    /* Enhanced viewport containment */
    overflow: hidden;
    contain: strict;
    clip-path: inset(0);
    isolation: isolate;
    /* GPU acceleration */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    background:
      repeating-radial-gradient(
        circle at 50% 50%,
        transparent 0,
        rgba(255, 255, 255, 0.01) 1px,
        transparent 2px,
        transparent 3px
      ),
      url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence baseFrequency='0.9' numOctaves='4' seed='5'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.4'/%3E%3C/svg%3E");
    background-size:
      3px 3px,
      100px 100px;
    animation:
      interference 5s linear infinite,
      static-shift 0.5s steps(10) infinite;
  }

  /* Voltage Fluctuation Effect - Desktop only */
  @media (hover: hover) and (min-width: 768px) {
    body {
      animation: voltage-flicker 20s ease-in-out infinite;
    }
  }

  /* Pixel Grid Overlay */
  .matrix-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
    pointer-events: none;
    opacity: 0.03;
    z-index: 0;
    /* Viewport containment */
    overflow: hidden;
    contain: strict;
    clip-path: inset(0);
    isolation: isolate;
    /* GPU acceleration */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    background-image:
      repeating-linear-gradient(
        0deg,
        transparent,
        transparent 1px,
        rgba(0, 255, 0, 0.05) 1px,
        rgba(0, 255, 0, 0.05) 2px
      ),
      repeating-linear-gradient(
        90deg,
        transparent,
        transparent 1px,
        rgba(0, 255, 0, 0.05) 1px,
        rgba(0, 255, 0, 0.05) 2px
      );
    background-size: 2px 2px;
    animation: pixel-drift 60s linear infinite;
  }

  /* Pause animations when tab is not visible for battery saving */
  @media not all and (prefers-reduced-motion: reduce) {
    .crt-screen[data-paused="true"]::before,
    .crt-screen[data-paused="true"]::after,
    .crt-overlay[data-paused="true"],
    .crt-overlay[data-paused="true"]::before,
    .crt-overlay[data-paused="true"]::after,
    .crt-static[data-paused="true"],
    .matrix-bg[data-paused="true"] {
      animation-play-state: paused !important;
    }
  }
}
