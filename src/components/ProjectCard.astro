---
export interface Props {
  title: string;
  description: string;
  tags: string[];
  githubUrl?: string;
  demoUrl?: string;
  featured?: boolean;
  index?: number;
}

const { title, description, tags, githubUrl, demoUrl, featured = false, index = 0 } = Astro.props;

const animationDelay = `${index * 0.1}s`;

const tagCategories = {
  green: ["c", "rust", "python", "javascript", "typescript", "c++", "java", "go", "ruby", "swift"],
  cyan: ["react", "vue", "angular", "next", "astro", "svelte", "django", "flask", "express", "qt"],
  red: ["kernel", "driver", "embedded", "linux", "aosp", "rom", "bsp", "bootloader"],
  magenta: ["docker", "kubernetes", "git", "ci/cd", "jenkins", "qemu", "yocto", "buildroot"],
  yellow: ["mongodb", "postgres", "mysql", "redis", "sqlite", "database", "sql"],
};

const tagColors = {
  green: "tag-green",
  cyan: "tag-cyan",
  red: "tag-red",
  magenta: "tag-magenta",
  yellow: "tag-yellow",
  blue: "tag-blue",
};

function getTagColor(tag: string): string {
  const lowerTag = tag.toLowerCase();

  for (const [color, keywords] of Object.entries(tagCategories)) {
    if (keywords.some((keyword) => lowerTag.includes(keyword))) {
      return tagColors[color as keyof typeof tagColors];
    }
  }

  return tagColors.blue;
}
---

<div
  class:list={[
    "card-base",
    "card-base-default",
    "card-base-hoverable",
    "glitch-border-hover",
    featured && "card-base-featured",
  ]}
  style={`animation: slide-in 0.6s ease-out forwards; animation-delay: ${animationDelay}; opacity: 0;`}
>
  <div class="card-section-header project-header">
    <h3 class="project-title">
      <span class="title-prompt">&gt;</span>
      {title}
    </h3>
    {featured && <span class="featured-badge">Featured</span>}
  </div>

  <div class="card-section-content project-content">
    <p class="project-description">{description}</p>

    <div class="project-tags">
      {tags.map((tag) => <span class:list={`tag ${getTagColor(tag)}`}>{tag}</span>)}
    </div>
  </div>

  <div class="card-section-footer project-footer">
    <div class="project-links">
      {
        githubUrl && (
          <a href={githubUrl} target="_blank" rel="noopener noreferrer" class="project-link">
            <span class="link-bracket">[</span>
            GitHub
            <span class="link-bracket">]</span>
          </a>
        )
      }
      {
        demoUrl && (
          <a href={demoUrl} target="_blank" rel="noopener noreferrer" class="project-link demo">
            <span class="link-bracket">[</span>
            Demo
            <span class="link-bracket">]</span>
          </a>
        )
      }
    </div>
  </div>
</div>

<style>
  /* ProjectCard-specific header layout */
  .project-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 0.5rem;
  }

  .project-title {
    margin: 0;
    font-size: 1.125rem;
    font-weight: bold;
    color: var(--text-primary);
    font-family: DepartureMono, monospace;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    line-height: 1.4;
  }

  .title-prompt {
    margin-right: 0.5rem;
    color: var(--accent-primary);
  }

  .featured-badge {
    padding: 0.25rem 0.5rem;
    background: var(--accent-primary);
    color: var(--bg-primary);
    font-size: 0.75rem;
    font-family: DepartureMono, monospace;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: bold;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .project-description {
    margin: 0 0 1rem 0;
    font-size: 0.875rem;
    color: var(--text-secondary);
    line-height: 1.6;
  }

  /* ProjectCard tag system */
  .project-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .tag {
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
    font-family: DepartureMono, monospace;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border: 1px solid;
    transition: all 0.2s ease;
    font-weight: 600;
  }

  .tag-green {
    color: var(--term-bright-green);
    border-color: var(--term-bright-green);
  }

  .tag-cyan {
    color: var(--term-bright-cyan);
    border-color: var(--term-bright-cyan);
  }

  .tag-red {
    color: var(--term-bright-red);
    border-color: var(--term-bright-red);
  }

  .tag-magenta {
    color: var(--term-bright-magenta);
    border-color: var(--term-bright-magenta);
  }

  .tag-yellow {
    color: var(--term-bright-yellow);
    border-color: var(--term-bright-yellow);
  }

  .tag-blue {
    color: var(--term-bright-blue);
    border-color: var(--term-bright-blue);
  }

  /* ProjectCard links */
  .project-links {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .project-link {
    font-size: 0.875rem;
    font-family: DepartureMono, monospace;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--term-bright-green);
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .project-link.demo {
    color: var(--term-bright-magenta);
  }

  .link-bracket {
    color: var(--text-secondary);
    opacity: 0.7;
  }

  /* Terminal cursor and CRT glitch effects (component-specific targeting) */
  @media (hover: hover) {
    .card-base-hoverable:hover .project-description::after {
      content: "â–Š";
      animation: cursor-blink 1s infinite;
      color: var(--accent-primary);
      font-weight: bold;
      margin-left: 2px;
    }

    .card-base-hoverable:hover .project-content {
      animation: crt-text-glitch 0.5s ease-in-out;
    }

    .tag:hover {
      transform: scale(1.05);
    }

    .project-link:hover {
      color: var(--term-bright-cyan);
      text-decoration: underline;
    }
  }

  /* Mobile responsive adjustments */
  @media (max-width: 640px) {
    .project-title {
      font-size: 1rem;
    }

    .project-description {
      font-size: 0.75rem;
    }

    .featured-badge {
      font-size: 0.625rem;
      padding: 0.2rem 0.4rem;
    }

    .tag {
      font-size: 0.625rem;
      padding: 0.2rem 0.4rem;
    }

    .project-link {
      font-size: 0.75rem;
    }

    .project-links {
      gap: 1.5rem;
    }
  }
</style>
