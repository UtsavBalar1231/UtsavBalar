---
import { skills, tools } from "@data/skills";

const hashString = (str: string): number => {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    hash = (hash << 5) - hash + str.charCodeAt(i);
    hash = hash & hash; // Convert to 32-bit integer
  }
  return Math.abs(hash);
};

const getCPU = (level: string, skillName: string): string => {
  const ranges = {
    proficient: [85, 95],
    "semi-proficient": [55, 70],
    familiar: [20, 40],
  };
  const [min, max] = ranges[level as keyof typeof ranges] || [50, 60];
  const range = max - min;
  const hash = hashString(skillName);
  const value = min + (hash % (range * 10)) / 10;
  return value.toFixed(1);
};

const getMEM = (level: string, skillName: string): string => {
  const ranges = {
    proficient: [2.0, 5.0],
    "semi-proficient": [1.0, 3.0],
    familiar: [0.5, 1.5],
  };
  const [min, max] = ranges[level as keyof typeof ranges] || [1, 2];
  const range = max - min;
  const hash = hashString(skillName);
  const value = min + (hash % (range * 10)) / 10;
  return value.toFixed(1);
};
---

<div class="terminal-output">
  <!-- Skills process listing -->
  <div class="terminal-command">
    <span class="prompt">$</span>
    <span class="command">ps aux | grep -i skill</span>
  </div>
  <div class="process-list">
    <div class="ps-header">
      <span class="col-user">USER</span>
      <span class="col-pid">PID</span>
      <span class="col-cpu">%CPU</span>
      <span class="col-mem">%MEM</span>
      <span class="col-command">COMMAND</span>
    </div>
    {
      skills.map((skill, index) => (
        <div class="ps-line">
          <span class="col-user">utsav</span>
          <span class="col-pid">{1337 + index}</span>
          <span class="col-cpu">{getCPU(skill.level, skill.name)}</span>
          <span class="col-mem">{getMEM(skill.level, skill.name)}</span>
          <span class="col-command">{skill.name}</span>
          <span class="col-comment"># {skill.level}</span>
        </div>
      ))
    }
  </div>

  <!-- Tools process listing -->
  <div class="terminal-command">
    <span class="prompt">$</span>
    <span class="command">ps aux | grep -i tool</span>
  </div>
  <div class="process-list">
    <div class="ps-header">
      <span class="col-user">USER</span>
      <span class="col-pid">PID</span>
      <span class="col-cpu">%CPU</span>
      <span class="col-mem">%MEM</span>
      <span class="col-command">COMMAND</span>
    </div>
    {
      tools.map((tool, index) => {
        const hash = hashString(tool);
        const cpu = 85 + (hash % 150) / 10; // 85-100%
        const mem = 3.0 + (hash % 60) / 10; // 3.0-9.0%
        return (
          <div class="ps-line">
            <span class="col-user">utsav</span>
            <span class="col-pid">{2001 + index}</span>
            <span class="col-cpu">{cpu.toFixed(1)}</span>
            <span class="col-mem">{mem.toFixed(1)}</span>
            <span class="col-command">{tool}</span>
          </div>
        );
      })
    }
  </div>
</div>

<style>
  .terminal-output {
    container-type: inline-size;
    container-name: skills-grid;
    font-family: monospace;
    color: var(--text-primary);
  }

  .terminal-command {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    margin-top: 1rem;
  }

  .terminal-command:first-child {
    margin-top: 0;
  }

  .prompt {
    color: var(--accent-primary);
    font-weight: bold;
  }

  .command {
    color: var(--text-primary);
  }

  .process-list {
    margin-bottom: 1.5rem;
    padding: 0.5rem 0;
  }

  .ps-header,
  .ps-line {
    display: flex;
    gap: 1rem;
    margin-bottom: 0.25rem;
    font-size: 0.875rem;
  }

  .ps-header {
    color: var(--text-secondary);
    font-weight: bold;
    margin-bottom: 0.5rem;
    opacity: 0.8;
  }

  .ps-line {
    color: var(--text-primary);
  }

  /* Column widths and alignment */
  .col-user {
    min-width: 60px;
  }

  .col-pid {
    min-width: 50px;
    text-align: right;
  }

  .col-cpu {
    min-width: 50px;
    text-align: right;
  }

  .col-mem {
    min-width: 50px;
    text-align: right;
  }

  .col-command {
    flex: 1;
    min-width: 200px;
  }

  .col-comment {
    color: var(--text-secondary);
    opacity: 0.7;
    margin-left: 0.5rem;
  }

  /* Responsive adjustments based on component size */
  @container skills-grid (max-width: 640px) {
    .ps-header,
    .ps-line {
      font-size: 0.75rem;
      gap: 0.5rem;
    }

    .col-user {
      min-width: 50px;
    }

    .col-pid {
      min-width: 40px;
    }

    .col-cpu {
      min-width: 45px;
    }

    .col-mem {
      min-width: 45px;
    }

    .col-command {
      min-width: 120px;
    }

    .col-comment {
      display: none;
    }
  }
</style>
